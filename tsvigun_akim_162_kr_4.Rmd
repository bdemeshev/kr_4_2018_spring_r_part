---
title: "tsvigun_akim_162_kr_4"
author: "Цвигун Аким"
date: "05 06 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
library(maxLik)
library(nycflights13)
```

### Симулируем бурную деятельность!

В качестве параметра $k$ в задаче используй число букв в своей фамилии в именительном падеже :)

Каждый день Василий съедает случайное количество булочек, которое распределено по Пуассону с параметром $10$. 
Логарифм затрат в рублях на каждую булочку распределён нормально $N(2, 1)$.  
Андрей каждый день съедает биномиальное количество булочек $Bin(2k, 0.5)$. 
Затраты Андрей на каждую булочку распределены равномерно на отрезке $[2;20]$.

1. Сколько в среднем тратит Василий на булочки за день? 

2. Чему равна дисперсия дневных расходов Василия?

3. Какова вероятность того, что за один день Василий потратит больше денег, чем Андрей?

4. Какова условная вероятность того, что Василий за день съел больше булочек, чем Андрей, если известно, что Василий потратил больше денег?

```{r}
n_sim <- 10^4
k <- 7
set.seed(1488)
all <- tibble(n_vas = rpois(n=n_sim, lambda=10),
              p_log_vas = rnorm(n=n_sim, mean=2, sd=1),
              n_and = rbinom(n=n_sim, size=2*k, prob=0.5),
              p_and = runif(n=n_sim, min=2, max=20))
```

Оцениваем нужные величины.
```{r}
all2 <- mutate(all,
               vas_money = exp(p_log_vas) * n_vas,
               and_money = n_and * p_and,
               event_one = exp(p_log_vas) > p_and,
               event_two = n_vas > n_and)
```

Средние ежедневные затраты Василия в рублях:
```{r}
mean(all2$vas_money)
```

Дисперсия ежедневных затрат Василия в рублях:
```{r}
var(all2$vas_money)
```

Вероятность того, что Василий потратит больше денег:
```{r}
mean(all2$event_one)
```

Вероятность того, что Василий купил больше, если он потратил больше денег:
```{r}
mean(subset(all2, event_one)$event_two)
```
### Сражаемся с реальностью!

В пакете `nycflights13` встроен набор данных `weather` о погоде в разные дни в разных аэропортах.


1. Постройте гистограмму переменной влажность, `humid`. У графика подпишите оси! 

2. Постройте диаграмму рассеяния переменных влажность и количество осадков, `precip`. У графика подпишите оси! 

3. Посчитайте выборочное среднее и выборочную дисперсию влажности и количества осадков.

4. С помощью максимального правдоподобия оцените параметр $\mu$, предположив, что наблюдения за влажностью имеют нормальное $N\left(\mu, 370\right)$-распределение и независимы.
Постройте 95\%-ый доверительный интервал для $\mu$.

5. С помощью максимального правдоподобия оцените параметр $\sigma^2$, предположив, что наблюдения за влажностью имеют нормальное $N\left(60, \sigma^2\right)$-распределение и независимы. Постройте 95\%-ый доверительный интервал для $\sigma^2$.

Если при численной оптимизации параметр $\sigma^2$ становится отрицательным, можно задать параметры по-другому, например, $\sigma^2 = \exp(\gamma)$.

```{r}
weather_new <- na.omit(weather)
```

```{r}
qplot(data=weather_new, x=humid, xlab='Значение влажности', ylab='Частота')
```

```{r}
qplot(data=weather_new, x=humid, y=precip, xlab='Влажность', ylab='Количество осадков')
```

Инициализируем переменные:
```{r}
my_precip = weather_new$precip
my_humid = weather_new$humid
```

Выборочное среднее количества осадков:
```{r}
mean(my_precip)
```

Выборочная дисперсия количества осадков:
```{r}
var(my_precip)
```

Выборочное среднее влажности:
```{r}
mean(my_humid)
```

Выборочная дисперсия влажности:
```{r}
var(my_humid)
```

Определим лог-функцию правдоподобия:
```{r}
logl <- function(theta, x) {
  mu <- theta[1]
  sigma <- theta[2]
  n <- length(x)
  res <- -n/2 * log(sigma^2) - 1/2/sigma^2 * sum((x - mu)^2)
  return(res)
  
}
```

Максимизируем правдоподобие для $\mu$!
```{r}
mu <- mean(my_humid)
theta_0 <- c(mu, 370)
model <- maxLik(logl, start=theta_0, x=my_humid)
summary(model)
```

Посчитаем переменные для 95\%-го доверительного интервала:
```{r}
ml_mu = 59.8756
z = 1.96
coef = (370 / length(my_humid))^(1/2)
part_left = ml_mu - z * coef
part_right = ml_mu + z * coef
```

Доверительный интервал: 
$59.627 \leq \mu \leq 60.124$

Максимизируем правдоподобие для $\sigma^2$!
```{r}
sigma_sq <- var(my_humid)
theta_0 <- c(60, sigma_sq)
model <- maxLik(logl, start=theta_0, x=my_humid)
summary(model)
```

<!--

5. С помощью максимального правдоподобия оцените параметры $\mu$, $\sigma^2$, предположив, что наблюдения за влажностью имеют нормальное $N(\mu, \sigma^2)$-распределение и независимы, однако усечены снизу нулём, а сверху — числом 100. Другими словами, оцените параметры модели
\[
humid_i = 
\begin{cases}
0, \text{ если } W_i < 0; \\
W_i, \text{ если } W_i \in [0;100]; \\
100, \text{ если } W_i > 100; \\
\end{cases},
\]
где $W_i \sim N(\mu, \sigma^2)$.

-->









