---
title: "Контрольная 4"
author: "АИДА ЧУШКИНА"
date: "29 05 2018"
output: html_document
lang: ru-RU
editor_options: 
  chunk_output_type: console
---

Меня зовут Аида-sun и я очень рад четвёртой контрольной :)

Для начала надо подкрепиться!

```{r, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(tidyverse) 
library(maxLik) 
library(nycflights13)
```


В качестве параметра $k$ в задаче используй число букв в своей фамилии в именительном падеже :)

Каждый день Василий съедает случайное количество булочек, которое распределено по Пуассону с параметром $10$. Логарифм затрат в рублях на каждую булочку распределён нормально $N(2, 1)$.
Андрей каждый день съедает биномиальное количество булочек $Bin(2k, 0.5)$. Затраты Андрей на каждую булочку распределены равномерно на отрезке $[2;20]$.

```{r}
n_sim <- 10000
set.seed(50)
sim <- tibble(x = rpois(n_sim, lambda = 10),
              y = rnorm(n_sim, mean = 2, sd = 1),
              z = rbinom(n_sim, size=22, prob=0.5),
              u=runif(n_sim, min=2, max=20))
```


Сколько в среднем тратит Василий на булочки за день?
```{r}
mean(sim$x)
```

```{r}
sim2 <- mutate(sim,event=exp(y)-u>0, event_2=x-z>0, o=exp(y))
```
Чему равна дисперсия дневных расходов Василия?
```{r}
var(sim2$o)
```

Какова вероятность того, что за один день Василий потратит больше денег, чем Андрей?

```{r}
mean(sim2$event)
```


Какова условная вероятность того, что Василий за день съел больше булочек, чем Андрей, если известно, что Василий потратил больше денег?

Предположим, что события A- что Василий съел больше и B- Василий потратил больше , независимы, тогда $P(A|B)=\frac{P(A)*P(B)}{P(B)}$

```{r}
'P(A|B)'= z =mean(sim2$event_2)*mean(sim2$event)/mean(sim2$event)
show(z)
```



В пакете nycflights13 встроен набор данных weather о погоде в разные дни в разных аэропортах.

Постройте гистограмму переменной влажность, humid. У графика подпишите оси!
```{r}
hist(weather$humid, breaks = 20, freq = FALSE, col = "greenyellow",
      xlab = "Переменная Влажность",
      ylab = "Frequency",
      main = "Гистограмма влажности")
```

Постройте диаграмму рассеяния переменных влажность и количество осадков, precip. У графика подпишите оси!

```{r}
plot(weather$humid, weather$precip, xlab = "Переменная влажность",
     ylab = "Количество осадков")
```


Посчитайте выборочное среднее и выборочную дисперсию влажности и количества осадков.

```{r}
Mean <- c( mean(na.omit(weather$humid)), mean(na.omit(weather$precip)))
SD_2 <- c (sd(na.omit(weather$humid)), sd(na.omit(weather$precip)))
N <- c('Влажность' , 'Кол-во осадков')
TA <- data_frame(N, Mean, SD_2^2)

TA
```


С помощью максимального правдоподобия оцените параметр $\mu$, предположив, что наблюдения за влажностью имеют нормальное $N\left(\mu, 370\right)$-распределение и независимы. Постройте 95%-ый доверительный интервал для $\mu$.

определим функцию правдоподобия:
```{r}
x <- na.omit(weather$humid)
```

```{r}
logl <- function(param, x)  {
  mu <- param
  N <- length(x)
  ll <- -0.5*N*log(2*pi) - N*log(sqrt(370)) - sum(0.5*(x - mu)^2/370)
return(ll) }
```


Максимизируем праводоподобие:

```{r}
res <- maxLik(logl, start=c(50), x=x) 
summary( res )
```

С помощью максимального правдоподобия оцените параметр $\sigma^2$, предположив, что наблюдения за влажностью имеют нормальное $N\left(60, \sigma^2\right)$-распределение и независимы. Постройте 95%-ый доверительный интервал для $\sigma^2$.
```{r}
logp <- function(par, x)  {
  s2 <- par
  N <- length(x)
  lq <- -0.5*N*log(2*pi) - N*log(sqrt(s2)) - sum(0.5*(x - 60)^2/s2)
return(lq) }
```

```{r}
rus <- maxLik(logp, start=c(5), x=x) 
summary( rus )
```


Если при численной оптимизации параметр $\sigma^2$ становится отрицательным, можно задать параметры по-другому, например, $\sigma^2 = \exp(\gamma)$.




 


